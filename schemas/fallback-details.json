{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/Dicklesworthstone/doodlestein_self_releaser/schemas/fallback-details.json",
  "title": "DSR Fallback Details",
  "description": "Details payload for 'dsr fallback' command",
  "type": "object",
  "required": ["repo", "steps"],
  "properties": {
    "repo": {
      "type": "string",
      "description": "Repository name"
    },
    "version": {
      "type": "string",
      "description": "Version/tag used for the fallback"
    },
    "trigger": {
      "type": "string",
      "description": "Reason the fallback was triggered"
    },
    "steps": {
      "type": "array",
      "items": { "$ref": "#/$defs/fallback_step" },
      "description": "Steps executed during fallback"
    },
    "build_manifest": {
      "type": "string",
      "description": "Path to build manifest JSON"
    },
    "release_url": {
      "type": "string",
      "format": "uri",
      "description": "GitHub release URL"
    }
  },
  "$defs": {
    "fallback_step": {
      "type": "object",
      "required": ["command", "status", "exit_code"],
      "properties": {
        "command": {
          "type": "string",
          "enum": ["check", "build", "release"],
          "description": "Step name"
        },
        "status": {
          "type": "string",
          "enum": ["success", "partial", "error"],
          "description": "Step status"
        },
        "exit_code": {
          "type": "integer",
          "minimum": 0,
          "description": "Step exit code"
        },
        "run_id": {
          "type": "string",
          "format": "uuid",
          "description": "Run identifier for this step"
        },
        "duration_ms": {
          "type": "integer",
          "minimum": 0,
          "description": "Duration of step"
        },
        "error": {
          "type": "string",
          "description": "Error message if step failed"
        }
      }
    }
  }
}
